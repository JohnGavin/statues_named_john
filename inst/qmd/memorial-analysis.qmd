---
title: "Comparing London Memorials: Johns, Women, and Dogs (Updated)"
format:
  html:
    code-fold: true
    code-summary: "Show code"
    toc: true
vignette: >
  %\VignetteIndexEntry{Comparing London Memorials: Johns, Women, and Dogs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  warning = FALSE,
  message = FALSE
)
```

> In England’s grand capital, dear,<br>
> More Johns than dames, it appears.<br>
> For each woman of might,<br>
> A John’s in plain sight,<br>
> Confirming our gendered-statue fears.

## Introduction

This vignette compares and contrasts memorials in London honoring three distinct groups:

1. **Men named John** - to examine how common male figures are commemorated
2. **Women** (of any name) - to assess gender representation in public memorials
3. **Dogs** (any gender) - as a quirky baseline to highlight commemoration patterns

**Data Sources**: 
* **Wikidata**: Structured data for statues and public art in London.
* **OpenStreetMap**: Crowdsourced data for memorials and statues.

## Load Data

We use the `targets` package to manage the data pipeline.

```{r packages}
# Note: statuesnamedjohn not loaded - vignette uses pre-computed targets objects
# devtools::load_all()  # Uncomment if package functions are needed
library(dplyr)
library(ggplot2)
library(sf)
library(targets)
library(leaflet)
```

```{r load-data}
# Load data from targets pipeline
# We assume targets::tar_make() has been run previously
if (dir.exists(file.path(rprojroot::find_root(rprojroot::is_r_package), "_targets"))) {
  # Set path to project root
  tar_config_set(store = file.path(rprojroot::find_root(rprojroot::is_r_package), "_targets"))
  
  all_memorials <- targets::tar_read(all_memorials, store = "_targets")
  summary_table <- targets::tar_read(summary_table, store = "_targets")
  findings <- targets::tar_read(findings, store = "_targets")
  category_plot <- targets::tar_read(category_plot, store = "_targets")
  memorial_map_plot <- targets::tar_read(memorial_map_plot, store = "_targets")
  johns_comparison <- targets::tar_read(johns_comparison, store = "_targets")
  memorial_interactive_map <- targets::tar_read(memorial_interactive_map, store = "_targets")
  
  gender_analysis <- targets::tar_read(gender_analysis, store = "_targets")
} else {
  message("Targets pipeline store not found. Please run targets::tar_make() to generate data.")
  # Create dummy data for rendering if pipeline not run
  all_memorials <- data.frame()
  summary_table <- data.frame()
  findings <- data.frame()
  category_plot <- ggplot()
  memorial_map_plot <- ggplot()
  johns_comparison <- list(message = "Pipeline not run", claim_validated = FALSE, john_statues = 0, john_percent = 0, woman_statues = 0, woman_percent = 0)
  memorial_interactive_map <- leaflet()
  gender_analysis <- list(top_names_by_gender = data.frame())
}
```

## Data Overview

```{r summary-stats}
knitr::kable(summary_table,
             caption = "Gender Representation Summary")
```

## Top Names by Gender

We extracted the first names from the memorials to identify the most common names for each gender group.

::: {.panel-tabset}

## Female

```{r top-names-female}
top_names_f <- gender_analysis$top_names_by_gender %>%
  dplyr::filter(inferred_gender == "Female") %>%
  dplyr::select(Name = extracted_names, Count = n, Percent = percent) %>%
  dplyr::arrange(desc(Count))

knitr::kable(top_names_f, caption = "Most Common Female Names")
```

## Male

```{r top-names-male}
top_names_m <- gender_analysis$top_names_by_gender %>%
  dplyr::filter(inferred_gender == "Male") %>%
  dplyr::select(Name = extracted_names, Count = n, Percent = percent) %>%
  dplyr::arrange(desc(Count))

knitr::kable(top_names_m, caption = "Most Common Male Names")
```

## Animal

```{r top-names-animal}
top_names_a <- gender_analysis$top_names_by_gender %>%
  dplyr::filter(inferred_gender == "Animal") %>%
  dplyr::select(Name = extracted_names, Count = n, Percent = percent) %>%
  dplyr::arrange(desc(Count))

knitr::kable(top_names_a, caption = "Most Common Animal Names")
```

## Unknown

```{r top-names-unknown}
top_names_u <- gender_analysis$top_names_by_gender %>%
  dplyr::filter(inferred_gender == "Unknown") %>%
  dplyr::select(Name = extracted_names, Count = n, Percent = percent) %>%
  dplyr::arrange(desc(Count))

knitr::kable(top_names_u, caption = "Most Common Unknown Names")
```

:::

## Representation Analysis

```{r visualization}
category_plot
```

## Geographic Distribution

We can map the location of these memorials to see spatial patterns.

### Interactive Map

Explore the memorials interactively. Click clusters to zoom in, and click markers to see details.

```{r interactive-map}
memorial_interactive_map
```

## Comparison with External Studies

The campaign [Statues for Equality](https://statuesforequality.com/pages/london) claims that:
* "The percentage of women’s statues in the UK that aren’t mythical or royal is approximately 3%"
* "More statues of men named John dotted around the country than of women!"

Our analysis of London-specific data finds:

* **`r johns_comparison$message`**

**Validation**: The claim that there are "more statues of men named John than of women" is **`r if(johns_comparison$claim_validated) "supported" else "refuted"`** by our current London dataset.

* **Men named John**: `r johns_comparison$john_statues` (`r johns_comparison$john_percent`%)
* **Women**: `r johns_comparison$woman_statues` (`r johns_comparison$woman_percent`%)

*(Note: Percentages are relative to the total dataset of queried memorials).*

## Session Info

```{r session-info}
sessionInfo()
```