---
title: "Comparing London Memorials: Johns, Women, and Dogs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Comparing London Memorials: Johns, Women, and Dogs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  warning = FALSE,
  message = FALSE
)
```

## Introduction

This vignette compares and contrasts memorials in London honoring three distinct groups:

1. **Men named John** - to examine how common male figures are commemorated
2. **Women** (of any name) - to assess gender representation in public memorials
3. **Dogs** (any gender) - as a quirky baseline to highlight commemoration patterns

We'll analyze these memorials by:

- Type (statues, plaques, monuments, etc.)
- Year and decade erected
- Location information
- Other distinguishing factors

## Load Required Packages

```{r packages}
library(londonremembers)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
library(lubridate)
```

## Data Collection

Let's collect real data for each of our three groups by scraping the London Remembers website.

**Note**: This may take several minutes as we're querying the website. The results are cached in the vignette to avoid repeated requests.

```{r collect-data, cache=TRUE, message=TRUE}
# Collect memorials for men named John
message("Collecting memorials for men named John...")
johns <- search_memorials("John", pages = 3) %>%
  mutate(category = "Men named John")

# Collect memorials for women
# Search multiple terms to get comprehensive results
message("Collecting memorials for women...")
women_terms <- c("woman", "women", "queen", "lady", "dame")
women_results <- lapply(women_terms, function(term) {
  Sys.sleep(1) # Be polite to the server
  search_memorials(term, pages = 2)
})
women <- bind_rows(women_results) %>%
  distinct(url, .keep_all = TRUE) %>%
  mutate(category = "Women")

# Collect memorials for dogs
message("Collecting memorials for dogs...")
dogs <- search_memorials("dog", pages = 2) %>%
  mutate(category = "Dogs")

# Combine all data
all_memorials <- bind_rows(johns, women, dogs)

message(sprintf("Collected %d memorials total", nrow(all_memorials)))
message(sprintf("  Johns: %d", sum(all_memorials$category == "Men named John")))
message(sprintf("  Women: %d", sum(all_memorials$category == "Women")))
message(sprintf("  Dogs: %d", sum(all_memorials$category == "Dogs")))
```

```{r prepare-data}
# Clean and prepare the data for analysis
# Note: The scraping functions return basic info
# For more detailed analysis, we could fetch full details for each memorial

# Show a preview of the data
if (nrow(all_memorials) > 0) {
  knitr::kable(
    head(all_memorials, 10),
    caption = "Sample of Collected Memorial Data"
  )
} else {
  message("Warning: No data collected. The website structure may have changed.")
  message("This vignette demonstrates the analysis workflow with the available data.")
}
```

## Summary Statistics

Let's start with basic counts:

```{r summary-stats}
summary_table <- all_memorials %>%
  group_by(category) %>%
  summarise(
    Total = n(),
    `Unique Memorials` = n_distinct(title, na.rm = TRUE)
  ) %>%
  arrange(desc(Total))

knitr::kable(summary_table,
             caption = "Memorial Summary by Category")
```

## Memorial Types

### Distribution by Type and Category

```{r memorial-types-table}
type_table <- all_memorials %>%
  group_by(category, type) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = category, values_from = count, values_fill = 0) %>%
  arrange(desc(`Men named John` + Women + Dogs))

knitr::kable(type_table,
             caption = "Memorial Types by Category")
```

### Visualization: Memorial Types

```{r memorial-types-plot}
ggplot(all_memorials, aes(x = category, fill = type)) +
  geom_bar(position = "stack") +
  labs(
    title = "Distribution of Memorial Types",
    subtitle = "Comparing Johns, Women, and Dogs",
    x = "Category",
    y = "Number of Memorials",
    fill = "Memorial Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r memorial-types-proportion}
ggplot(all_memorials, aes(x = category, fill = type)) +
  geom_bar(position = "fill") +
  labs(
    title = "Proportion of Memorial Types",
    subtitle = "Comparing Johns, Women, and Dogs",
    x = "Category",
    y = "Proportion",
    fill = "Memorial Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = scales::percent)
```

## Memorial Types Analysis

The basic search provides memorial type information. For detailed temporal and geographic data, individual memorials would need to be fetched using `get_memorial()`.

### Memorial Type Distribution

```{r type-analysis}
if ("type" %in% names(all_memorials) && nrow(all_memorials) > 0) {
  type_counts <- all_memorials %>%
    filter(!is.na(type), type != "") %>%
    group_by(category, type) %>%
    summarise(count = n(), .groups = "drop") %>%
    arrange(category, desc(count))

  if (nrow(type_counts) > 0) {
    knitr::kable(
      type_counts %>%
        pivot_wider(names_from = category, values_from = count, values_fill = 0),
      caption = "Memorial Types by Category"
    )
  } else {
    message("Note: Memorial type information not available in search results")
  }
} else {
  message("Note: To get detailed memorial information including dates and types,")
  message("use get_memorial() on individual memorial URLs")
}
```

## Geographic Distribution

```{r location-analysis}
if ("location" %in% names(all_memorials) && nrow(all_memorials) > 0) {
  locations_available <- all_memorials %>%
    filter(!is.na(location), location != "")

  if (nrow(locations_available) > 0) {
    location_table <- locations_available %>%
      group_by(category, location) %>%
      summarise(count = n(), .groups = "drop") %>%
      group_by(category) %>%
      slice_max(order_by = count, n = 5) %>%
      arrange(category, desc(count))

    knitr::kable(location_table,
                 caption = "Top Locations by Category")

    # Location diversity
    diversity_stats <- locations_available %>%
      group_by(category) %>%
      summarise(
        `Total Memorials` = n(),
        `Unique Locations` = n_distinct(location),
        `Avg per Location` = round(n() / n_distinct(location), 2)
      )

    knitr::kable(diversity_stats,
                 caption = "Geographic Distribution Statistics")
  } else {
    message("Note: Location information not available in search results")
  }
} else {
  message("Note: For location data, use get_memorial() to fetch detailed information")
  message("for individual memorials")
}
```

## Key Findings

### Representation in Search Results

Based on our analysis of search results from London Remembers:

```{r findings-summary}
# Calculate some key metrics
if (nrow(all_memorials) > 0) {
  findings <- all_memorials %>%
    group_by(category) %>%
    summarise(
      count = n(),
      percentage = round(100 * n() / nrow(all_memorials), 1)
    )

  knitr::kable(findings,
               caption = "Distribution of Memorials by Category",
               col.names = c("Category", "Count", "Percentage (%)"))
}
```

### Interpretation

1. **Search Results Context**: These numbers represent memorials that match specific search terms on London Remembers, not a comprehensive count of all memorials in London.

2. **Gender Disparity**: The comparison between memorials for "men named John" versus memorials for "women" (all names) provides insight into potential gender imbalances in public commemoration.

3. **The "Dog Comparison"**: Including dogs in this analysis serves as a provocative baseline to highlight commemoration patterns. If dogs have comparable or more memorials than women, it emphasizes the historical underrepresentation of women in public spaces.

4. **Data Limitations**: The actual website structure may differ from our scraping expectations. For comprehensive analysis, each memorial's detailed page would need to be fetched individually using `get_memorial()`.

### Recommendations

For those interested in memorial equity:

1. **Document gaps**: Identify underrepresented groups and time periods
2. **Advocate for diversity**: Support new memorials honoring women and minorities
3. **Recontextualize existing memorials**: Add plaques or information about problematic figures
4. **Create interactive resources**: Use data like this to educate the public about representation

## Conclusion

This analysis reveals patterns in how London commemorates different groups through public memorials. The comparison between men named John, women of all names, and dogs serves as a lens to examine:

- Gender representation in public spaces
- Types of achievement deemed worthy of commemoration
- Historical and contemporary values reflected in memorial choices
- Geographic distribution of commemorative efforts

Future analyses could expand this to include:

- Racial and ethnic diversity in memorials
- Professional categories (scientists, artists, military, etc.)
- Memorial funding sources and installation processes
- Public sentiment and controversy around memorials

## Session Info

```{r session-info}
sessionInfo()
```
